bootstrap:npm-ci:
  stage: bootstrap
  rules:
    - !reference [.rules_default, rules]
  cache:
    key: npm-cache
    paths:
      - .cache
  before_script:
    - eval $(ssh-agent -s); echo "${SSH_PRIVATE_KEY}" | tr -d '\r' | ssh-add - > /dev/null; mkdir -p ~/.ssh; chmod 700 ~/.ssh
    - echo -e "Host ${CI_SERVER_HOST}\n\tStrictHostKeyChecking no\n" >> ~/.ssh/config
  script:
    - npm ci
  artifacts:
    expire_in: 2h
    when: on_success
    paths:
      - node_modules/
